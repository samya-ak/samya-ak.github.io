{"componentChunkName":"component---src-templates-blog-post-js","path":"/insert-or-update/","result":{"data":{"site":{"siteMetadata":{"title":"samya-ak"}},"markdownRemark":{"id":"508896c6-0e13-5267-b93c-65e208acb345","excerpt":"Requirement We want to insert a new document if none of the documents match provided filter, but update only specific field when a match is found. Current stateâ€¦","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0fb0e1384982ea5c0f5d3c3459e0e9cd/799f3/upsert.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 49.079754601226995%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABgElEQVQoz4WSWW7bMBRFvRTbEUWJFAeJlGRVgx07QZCfdv+rOYWoOk7RIP24eAQIXt7h7XLdkKkGd7riugvN8EJZj6gwU/iBg7QcpeGY5v+xk1XkqfAUfkTHBd2eUWGhqGcyHTlKxyE37EXFQVTbzLdzmve7fPt0l1cB5XuG+ZXQTrTTG/X8k2Z6JyzvhPMvTH+lnt5Q7QXTPWNON+zwgu5uSNNT2hahQiJNhLIKuDiiTMQ0E6q7YeKMDQOqvaYIXHfGtAs2TBS2R9qe3HTkOlCYSFbWD0JROEx9QjYL0g7shU429sJwEPrD6h2HT/NLy1nhyVWD0AGhmy3g3H48eGT2fTlJoTQRUXpcGKm659S2CTOqnijrH0h3Sm2XzYh0A/v0gfmm5dW/tGjXp6yqMKH8QOFPiKpFVJEsKY9JfVZ6ngr3R/m/SIRryL67oOMZu7bYLlRxRq/kzZgUriVo32PDSOn6RLwWsc0HUoa5rrd9E3/v1/GOT4t9t7uq/Aq/AafUL9/ZkZYXAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Code Snippet!\"\n        title=\"Code Snippet!\"\n        src=\"/static/0fb0e1384982ea5c0f5d3c3459e0e9cd/a6d36/upsert.png\"\n        srcset=\"/static/0fb0e1384982ea5c0f5d3c3459e0e9cd/222b7/upsert.png 163w,\n/static/0fb0e1384982ea5c0f5d3c3459e0e9cd/ff46a/upsert.png 325w,\n/static/0fb0e1384982ea5c0f5d3c3459e0e9cd/a6d36/upsert.png 650w,\n/static/0fb0e1384982ea5c0f5d3c3459e0e9cd/e548f/upsert.png 975w,\n/static/0fb0e1384982ea5c0f5d3c3459e0e9cd/3c492/upsert.png 1300w,\n/static/0fb0e1384982ea5c0f5d3c3459e0e9cd/799f3/upsert.png 1642w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h4>Requirement</h4>\n<p>We want to insert a new document if none of the documents match provided filter, but update only specific field when a match is found.</p>\n<h4>Current state of <code class=\"language-text\">favorite_books</code> collection</h4>\n<div class=\"gatsby-highlight\" data-language=\"go\"><pre class=\"language-go\"><code class=\"language-go\"><span class=\"token punctuation\">{</span>  <span class=\"token string\">\"_id\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>    <span class=\"token string\">\"$oid\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"6294228d3811a7c4c5044808\"</span>  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>  <span class=\"token string\">\"title\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"My Brilliant Friend\"</span><span class=\"token punctuation\">,</span>  <span class=\"token string\">\"author\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Elena Ferrante\"</span><span class=\"token punctuation\">,</span>  <span class=\"token string\">\"year_published\"</span><span class=\"token punctuation\">:</span> <span class=\"token number\">2012</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">{</span>  <span class=\"token string\">\"_id\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>    <span class=\"token string\">\"$oid\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"6294228d3811a7c4c5044809\"</span>  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>  <span class=\"token string\">\"title\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Lucy\"</span><span class=\"token punctuation\">,</span>  <span class=\"token string\">\"author\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Jamaica Kincaid\"</span><span class=\"token punctuation\">,</span>  <span class=\"token string\">\"year_published\"</span><span class=\"token punctuation\">:</span> <span class=\"token number\">2002</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">{</span>  <span class=\"token string\">\"_id\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>    <span class=\"token string\">\"$oid\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"6294228d3811a7c4c504480a\"</span>  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>  <span class=\"token string\">\"title\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Cat's Cradle\"</span><span class=\"token punctuation\">,</span>  <span class=\"token string\">\"author\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Kurt Vonnegut Jr.\"</span><span class=\"token punctuation\">,</span>  <span class=\"token string\">\"year_published\"</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1998</span><span class=\"token punctuation\">}</span></code></pre></div>\n<h4>Connect to database</h4>\n<div class=\"gatsby-highlight\" data-language=\"go\"><pre class=\"language-go\"><code class=\"language-go\"><span class=\"token keyword\">const</span> uri <span class=\"token operator\">=</span> <span class=\"token string\">\"mongodb://localhost:27017/?maxPoolSize=20&amp;w=majority\"</span>\nclient<span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> mongo<span class=\"token punctuation\">.</span><span class=\"token function\">Connect</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">.</span><span class=\"token function\">TODO</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">.</span><span class=\"token function\">Client</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">ApplyURI</span><span class=\"token punctuation\">(</span>uri<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">if</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token function\">panic</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">defer</span> <span class=\"token keyword\">func</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">if</span> err <span class=\"token operator\">=</span> client<span class=\"token punctuation\">.</span><span class=\"token function\">Disconnect</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">.</span><span class=\"token function\">TODO</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token function\">panic</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h4>Insert or Update</h4>\n<div class=\"gatsby-highlight\" data-language=\"go\"><pre class=\"language-go\"><code class=\"language-go\">coll <span class=\"token operator\">:=</span> client<span class=\"token punctuation\">.</span><span class=\"token function\">Database</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"myDB\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">Collection</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"favorite_books\"</span><span class=\"token punctuation\">)</span>\nfilter <span class=\"token operator\">:=</span> bson<span class=\"token punctuation\">.</span>D<span class=\"token punctuation\">{</span>\n\t<span class=\"token punctuation\">{</span><span class=\"token string\">\"title\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Lucy\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token punctuation\">{</span><span class=\"token string\">\"year_published\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1866</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span>\nopts <span class=\"token operator\">:=</span> options<span class=\"token punctuation\">.</span><span class=\"token function\">Update</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">SetUpsert</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\nupdateData <span class=\"token operator\">:=</span> bson<span class=\"token punctuation\">.</span>D<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span><span class=\"token string\">\"title\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Crime and Punishment\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span><span class=\"token string\">\"year_published\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1866</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\nupdate <span class=\"token operator\">:=</span> bson<span class=\"token punctuation\">.</span>D<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span><span class=\"token string\">\"$set\"</span><span class=\"token punctuation\">,</span> bson<span class=\"token punctuation\">.</span>D<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span><span class=\"token string\">\"author\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Fyodor Dostoyevsky\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span><span class=\"token string\">\"$setOnInsert\"</span><span class=\"token punctuation\">,</span> updateData<span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\nres<span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> coll<span class=\"token punctuation\">.</span><span class=\"token function\">UpdateOne</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">.</span><span class=\"token function\">TODO</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> filter<span class=\"token punctuation\">,</span> update<span class=\"token punctuation\">,</span> opts<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">if</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span>\n\tfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">if</span> res<span class=\"token punctuation\">.</span>MatchedCount <span class=\"token operator\">!=</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">{</span>\n\tfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"matched and updated an existing document\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">if</span> res<span class=\"token punctuation\">.</span>UpsertedCount <span class=\"token operator\">!=</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">{</span>\n\tfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"inserted a document with id: %v\\n\"</span><span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">.</span>UpsertedID<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>From the mongodb docs,</p>\n<blockquote>\n<p>An upsert performs one of the following actions:</p>\n<ul>\n<li>Update documents that match your query filter</li>\n<li>Insert a document if there are no matches to your query filter</li>\n</ul>\n</blockquote>\n<p>There is no document where <code class=\"language-text\">title</code> is Lucy and <code class=\"language-text\">year_published</code> is 1866, so the above code inserts a new document and the state of the collection changes to:</p>\n<div class=\"gatsby-highlight\" data-language=\"go\"><pre class=\"language-go\"><code class=\"language-go\"><span class=\"token punctuation\">{</span>  <span class=\"token string\">\"_id\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>    <span class=\"token string\">\"$oid\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"6294228d3811a7c4c5044808\"</span>  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>  <span class=\"token string\">\"title\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"My Brilliant Friend\"</span><span class=\"token punctuation\">,</span>  <span class=\"token string\">\"author\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Elena Ferrante\"</span><span class=\"token punctuation\">,</span>  <span class=\"token string\">\"year_published\"</span><span class=\"token punctuation\">:</span> <span class=\"token number\">2012</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">{</span>  <span class=\"token string\">\"_id\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>    <span class=\"token string\">\"$oid\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"6294228d3811a7c4c5044809\"</span>  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>  <span class=\"token string\">\"title\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Lucy\"</span><span class=\"token punctuation\">,</span>  <span class=\"token string\">\"author\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Jamaica Kincaid\"</span><span class=\"token punctuation\">,</span>  <span class=\"token string\">\"year_published\"</span><span class=\"token punctuation\">:</span> <span class=\"token number\">2002</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">{</span>  <span class=\"token string\">\"_id\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>    <span class=\"token string\">\"$oid\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"6294228d3811a7c4c504480a\"</span>  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>  <span class=\"token string\">\"title\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Cat's Cradle\"</span><span class=\"token punctuation\">,</span>  <span class=\"token string\">\"author\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Kurt Vonnegut Jr.\"</span><span class=\"token punctuation\">,</span>  <span class=\"token string\">\"year_published\"</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1998</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">{</span>  <span class=\"token string\">\"_id\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>    <span class=\"token string\">\"$oid\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"629424222932d1cc570ad0d0\"</span>  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>  <span class=\"token string\">\"title\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Crime and Punishment\"</span><span class=\"token punctuation\">,</span>  <span class=\"token string\">\"year_published\"</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1866</span><span class=\"token punctuation\">,</span>  <span class=\"token string\">\"author\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Fyodor Dostoyevsky\"</span><span class=\"token punctuation\">}</span></code></pre></div>\n<p>If we change the filter to</p>\n<div class=\"gatsby-highlight\" data-language=\"go\"><pre class=\"language-go\"><code class=\"language-go\">filter <span class=\"token operator\">:=</span> bson<span class=\"token punctuation\">.</span>D<span class=\"token punctuation\">{</span>\n\t<span class=\"token punctuation\">{</span><span class=\"token string\">\"title\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Crime and Punishment\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token punctuation\">{</span><span class=\"token string\">\"year_published\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1866</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>there is a document that match this query filter, hence we can update a specific field with the line</p>\n<div class=\"gatsby-highlight\" data-language=\"go\"><pre class=\"language-go\"><code class=\"language-go\">update <span class=\"token operator\">:=</span> bson<span class=\"token punctuation\">.</span>D<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span><span class=\"token string\">\"$set\"</span><span class=\"token punctuation\">,</span> bson<span class=\"token punctuation\">.</span>D<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span><span class=\"token string\">\"author\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Sasaki Kojirou\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span><span class=\"token string\">\"$setOnInsert\"</span><span class=\"token punctuation\">,</span> updateData<span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></code></pre></div>\n<p>We then get the following collection:</p>\n<div class=\"gatsby-highlight\" data-language=\"go\"><pre class=\"language-go\"><code class=\"language-go\"><span class=\"token punctuation\">{</span>  <span class=\"token string\">\"_id\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>    <span class=\"token string\">\"$oid\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"6294228d3811a7c4c5044808\"</span>  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>  <span class=\"token string\">\"title\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"My Brilliant Friend\"</span><span class=\"token punctuation\">,</span>  <span class=\"token string\">\"author\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Elena Ferrante\"</span><span class=\"token punctuation\">,</span>  <span class=\"token string\">\"year_published\"</span><span class=\"token punctuation\">:</span> <span class=\"token number\">2012</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">{</span>  <span class=\"token string\">\"_id\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>    <span class=\"token string\">\"$oid\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"6294228d3811a7c4c5044809\"</span>  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>  <span class=\"token string\">\"title\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Lucy\"</span><span class=\"token punctuation\">,</span>  <span class=\"token string\">\"author\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Jamaica Kincaid\"</span><span class=\"token punctuation\">,</span>  <span class=\"token string\">\"year_published\"</span><span class=\"token punctuation\">:</span> <span class=\"token number\">2002</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">{</span>  <span class=\"token string\">\"_id\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>    <span class=\"token string\">\"$oid\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"6294228d3811a7c4c504480a\"</span>  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>  <span class=\"token string\">\"title\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Cat's Cradle\"</span><span class=\"token punctuation\">,</span>  <span class=\"token string\">\"author\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Kurt Vonnegut Jr.\"</span><span class=\"token punctuation\">,</span>  <span class=\"token string\">\"year_published\"</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1998</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">{</span>  <span class=\"token string\">\"_id\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>    <span class=\"token string\">\"$oid\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"629424222932d1cc570ad0d0\"</span>  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>  <span class=\"token string\">\"title\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Crime and Punishment\"</span><span class=\"token punctuation\">,</span>  <span class=\"token string\">\"year_published\"</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1866</span><span class=\"token punctuation\">,</span>  <span class=\"token string\">\"author\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Sasaki Kojirou\"</span><span class=\"token punctuation\">}</span></code></pre></div>\n<p><strong>Note:</strong> Beware that field operators <code class=\"language-text\">$set</code> and <code class=\"language-text\">$setOnInsert</code> shouldnâ€™t have same fields since it would throw write exception.</p>\n<h4>Reference</h4>\n<ul>\n<li><a href=\"https://www.mongodb.com/docs/drivers/go/current/fundamentals/crud/write-operations/upsert/\">Insert or Update in a single operation</a></li>\n<li><a href=\"https://www.mongodb.com/docs/manual/reference/operator/update/setOnInsert/\">setOnInsert</a></li>\n</ul>","frontmatter":{"title":"Insert a document or Update Specific field","date":"February 22, 2024","description":"Insert a new document if none of the documents match provided filter, but update only specific field when a match is found"}},"previous":{"fields":{"slug":"/keycloak-customization/"},"frontmatter":{"title":"Customizing keycloak"}},"next":null},"pageContext":{"id":"508896c6-0e13-5267-b93c-65e208acb345","previousPostId":"1e3041cc-7233-5b53-9c57-48917d132f5f","nextPostId":null}},"staticQueryHashes":["230163734","3589320610","754622331"]}